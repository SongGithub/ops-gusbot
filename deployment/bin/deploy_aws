#! /bin/bash

set -e

if [ $# -lt 1 ]; then
  echo "Usage: deploy <environment> <docker image tag>"
  exit 1
fi

APP_ENV=$1
# IMAGE_TAG=$2

echo "--- Pulling deploy docker image..."
docker-compose -f deployment/docker-compose.yml pull stackup

echo "+++ Deploying to ${APP_ENV} environment..."
docker-compose -f deployment/docker-compose.yml run stackup gusbot-role up \
  -t deployment/iam-role.yml \
  -p deployment/${APP_ENV}/iam-params.yml \
  # -o AppApplicationVersion=${IMAGE_TAG} \
  # -o DockerImageTag=${IMAGE_TAG}
